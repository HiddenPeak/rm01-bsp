# LED矩阵动画系统

## 概述

这个系统允许用户通过JSON文件定义自定义LED矩阵动画，并通过TF卡加载这些动画。

## 动画JSON格式

动画文件应保存为`/sdcard/matrix.json`，格式如下：

```json
{
  "animations": [
    {
      "name": "动画名称1",
      "points": [
        {"type": "point", "x": 10, "y": 10, "r": 255, "g": 0, "b": 0},
        {"type": "line", "x1": 5, "y1": 5, "x2": 15, "y2": 15, "r": 0, "g": 255, "b": 0}
      ]
    },
    {
      "name": "动画名称2",
      "points": [
        // 更多点...
      ]
    }
  ]
}
```

### 支持的点类型

1. **单点**: 定义单个LED点
   ```json
   {"type": "point", "x": 10, "y": 10, "r": 255, "g": 0, "b": 0}
   ```
   - `type`: "point"（可选，默认为point）
   - `x`, `y`: 点的坐标 (0-31)
   - `r`, `g`, `b`: RGB颜色值 (0-255)

2. **线段**: 使用Bresenham算法绘制一条线
   ```json
   {"type": "line", "x1": 5, "y1": 5, "x2": 15, "y2": 15, "r": 0, "g": 255, "b": 0}
   ```
   - `type`: "line"
   - `x1`, `y1`: 起点坐标
   - `x2`, `y2`: 终点坐标
   - `r`, `g`, `b`: RGB颜色值 (0-255)

## 使用方法

1. 使用提供的模板文件 `matrix_template.json` 作为参考
2. 创建或修改自己的动画定义
3. 使用提供的脚本将文件复制到TF卡：
   - Windows: 运行 `.\copy_animation.ps1` PowerShell脚本
   - Linux/macOS: 运行 `./copy_animation.sh` bash脚本
4. 将TF卡插入设备，重启设备
5. 系统将自动加载TF卡上的自定义动画

## 文件系统挂载

本系统使用FatFS挂载TF卡文件系统。如果TF卡无法正确挂载，系统会：
1. 显示详细的错误信息
2. 尝试格式化TF卡（如需要）
3. 如果找不到动画文件，会创建一个默认的动画文件

## 排障指南

如果TF卡挂载失败，请检查：
1. TF卡是否正确插入
2. TF卡是否格式化为FAT16/FAT32格式
3. 日志输出中是否有详细错误信息

常见错误：
- `ESP_ERR_INVALID_STATE`: SDMMC硬件初始化问题
- `ESP_ERR_NO_MEM`: 内存不足
- `ESP_FAIL`: 可能是格式不兼容

## 限制

- 最多支持10个自定义动画
- 每个动画最多支持200个点
- 如果点数超过限制，多余的点将被忽略
- 如果JSON格式错误，将使用内置动画

## 示例

请参考 `matrix_template.json` 文件，其中包含了几个可以直接使用的动画示例。

## 高级用法

熟悉后，您可以：
1. 创建更复杂的线条艺术
2. 使用多种颜色创建渐变效果
3. 设计自己的图案和标志
4. 创建简单的像素艺术

## 技术细节

- LED矩阵尺寸：32x32 像素
- 坐标系：左上角为(0,0)，右下角为(31,31)
- 颜色格式：RGB，每个通道范围0-255
- JSON解析使用cJSON库
- 文件系统使用ESP-IDF的FATFS组件
